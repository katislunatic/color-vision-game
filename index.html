<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"> <meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Color-Vision Game</title>
<style>
:root{
  --bg:#0e0f14; --card:#0f1720; --text:#e6eef8;
}
html,body{
  height:100%;
  margin:0;
  overflow:hidden;
  touch-action:none;
  font-family:Inter,system-ui,Segoe UI,Arial;
  background:linear-gradient(180deg,#071022 0%, #0e1622 100%);
  color:var(--text);
  display:flex;
  align-items:center;
  justify-content:center;
}
.container {width:100%; max-width:980px; padding:20px; box-sizing:border-box;}
header {display:flex; align-items:center; justify-content:space-between; margin-bottom:18px;}
h1 {font-size:20px; margin:0;}
.meta {display:flex; gap:12px; align-items:center; flex-wrap: wrap;}
.btn {
  background:#1f2937;
  border:0;
  color:var(--text);
  padding:8px 12px;
  border-radius:8px;
  cursor:pointer;
  text-decoration:none;
}
.scoreboard {display:flex; gap:12px; align-items:center;}
.card {
  background:rgba(255,255,255,0.03);
  padding:16px;
  border-radius:12px;
  box-shadow:0 6px 18px rgba(2,6,23,0.6);
}

#board-wrap {
  display:flex; justify-content:center; align-items:center;
  margin-top:14px; width:100%;
}

#board {
  display:grid;
  gap:6px;
  touch-action: manipulation;
  width: 100%;
  max-width:480px;
}

button.tile, div.tile {
  border-radius:8px; 
  border:0; 
  outline:0; 
  cursor:pointer; 
  display:flex; 
  align-items:center; 
  justify-content:center; 
  width:100%; 
  aspect-ratio:1/1; 
  font-weight:bold; 
  color:var(--text); 
  text-align:center;
  transition: background 1.6s ease;
}

/* --- feedback box --- */
#message {
  font-size:15px;
  text-align:center;
  min-width: 240px;
  margin: 0 auto;
  align-self: center;
  margin-top: 20px;
}

/* message colors */
.msg-neutral { color:#cfd9ea; }
.msg-good    { color:#8bffa4; }
.msg-bad     { color:#ff7b7b; }

.controls {display:flex; gap:10px; align-items:center; margin-left:8px;}
.small {font-size:13px; color:#9fb0c8;}

@media (max-width:520px){
  header {flex-direction: column; align-items:flex-start; gap:8px;}
}
</style>
</head>

<body>
<div class="container">

<header>
  <div>
    <h1>Color-Vision Game</h1>
    <div class="small">Tap the tile that is slightly different.</div>
  </div>

  <div class="meta">
    <a href="./hard/" class="btn">Hard Mode</a>

    <div class="scoreboard card">
      <div>Score: <strong id="score">0</strong></div>
      <div>Level: <strong id="level">1</strong></div>
      <div>Time: <strong id="time">60</strong>s</div>
      <div>Best: <strong id="best">0</strong></div>
    </div>

    <div class="controls">
      <button id="startBtn" class="btn">Start</button>
      <button id="resetBtn" class="btn">Reset</button>
    </div>
  </div>
</header>

<div id="board-wrap">
  <div id="board" aria-live="polite"></div>
</div>

<div style="margin-top:14px; width:100%; display:flex; justify-content:center;">
  <div class="card small msg-neutral" id="message" style="padding:10px">Press Start or Tap a Tile to Begin</div>
</div>

<script>
(function(){
  const board = document.getElementById('board');
  const scoreEl = document.getElementById('score');
  const levelEl = document.getElementById('level');
  const timeEl = document.getElementById('time');
  const bestEl = document.getElementById('best');
  const startBtn = document.getElementById('startBtn');
  const resetBtn = document.getElementById('resetBtn');
  const message = document.getElementById('message');

  let score = 0, level = 1, timer = 60, timerId = null;
  let difficulty = 0.25;
  let feedbackTimeout = null;
  let best = Number(localStorage.getItem('kukubest') || 0);
  bestEl.textContent = best;

  let starterInterval = null;

  function setMessage(text, type="neutral"){
    message.textContent = text;
    message.className = `card small msg-${type}`;
  }

  // starter animation every 4 seconds
  function startStarterAnimation(){
    if(starterInterval) clearInterval(starterInterval);
    starterInterval = setInterval(()=>{
      buildStarterBoard();
    },2500);
  }

  function startGame(){
    if(starterInterval) clearInterval(starterInterval);

    score = 0; 
    level = 1; 
    timer = 60;
    updateUI();
    nextRound();

    if(timerId) clearInterval(timerId);
    timerId = setInterval(()=>{
      timer--;
      updateUI();
      if(timer<=0) endGame();
    },1000);

    setMessage("Find the odd tile!", "neutral");
    startBtn.disabled = true;
  }

  function resetGame(){
    score = 0; 
    level = 1; 
    timer = 60;
    updateUI();
    buildStarterBoard();

    if(timerId) clearInterval(timerId);
    timerId = null;

    startBtn.disabled = false;
    setMessage("Press Start or Tap a Tile to Begin","neutral");
    startStarterAnimation();
  }

  function endGame(){
    if(timerId) clearInterval(timerId);
    timerId = null;

    let finalMsg = `Game over — Score: ${score}`;
    if(score > best){
      best = score;
      localStorage.setItem('kukubest', best);
      bestEl.textContent = best;
      finalMsg += " — New best!";
    }

    setMessage(finalMsg, "bad");
    showGameOverBoard();
  }

  // GAME OVER BOARD
  function showGameOverBoard(){
    const gridSize = 2;
    board.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
    board.innerHTML = '';

    const bg = '#3d444c';

    for(let i=0;i<4;i++){
      const b = document.createElement('div');
      b.className = 'tile';
      b.style.background = bg;
      b.style.fontSize = '18px';
      b.textContent = 'GAME OVER';

      b.addEventListener('click', startGame);

      board.appendChild(b);
    }
  }

  function updateUI(){
    scoreEl.textContent = score;
    levelEl.textContent = level;
    timeEl.textContent = timer;
  }

  // MAIN GAME
  function nextRound(){
    let numBoxes;
    if(level===1) numBoxes=4;
    else if(level===2) numBoxes=9;
    else if(level===3) numBoxes=16;
    else if(level===4||level===5) numBoxes=25;
    else if(level===6||level===7) numBoxes=36;
    else if(level===8||level===9) numBoxes=49;
    else numBoxes=64;

    const gridSize = Math.sqrt(numBoxes);
    difficulty = Math.max(0.08, 0.4 - (level-1)*0.02);

    board.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
    board.innerHTML = '';

    const hue = Math.floor(Math.random()*360);
    const sat = 60 + Math.random()*20;
    const light = 40 + Math.random()*20;

    const base = `hsl(${hue} ${sat}% ${light}%)`;
    const delta = difficulty * 100;
    const targetLight = light + (Math.random()<0.5 ? delta : -delta);
    const target = `hsl(${hue} ${sat}% ${targetLight}%)`;

    const targetIndex = Math.floor(Math.random()*numBoxes);

    for(let i=0;i<numBoxes;i++){
      const btn = document.createElement('button');
      btn.className = 'tile';
      btn.style.background = (i===targetIndex) ? target : base;
      btn.dataset.isTarget = (i===targetIndex) ? '1' : '0';
      btn.addEventListener('click', onTileClick);
      board.appendChild(btn);
    }
  }

  function onTileClick(e){
    const isTarget = e.currentTarget.dataset.isTarget === '1';
    if(!timerId) return;

    if(feedbackTimeout) clearTimeout(feedbackTimeout);

    let penalty = 5 + Math.floor((level-1)/10);

    if(isTarget){
      score += Math.max(1, Math.floor(5 + Math.sqrt(level)));
      level++;
      timer = Math.min(999, timer + 2);
      updateUI();

      setMessage(`Nice! +2s`, "good");

      feedbackTimeout = setTimeout(()=>{ 
        if(timerId) setMessage('Find the odd tile!',"neutral");
      },2500);

      nextRound();
    } else {
      timer = Math.max(0, timer - penalty);
      updateUI();

      setMessage(`Wrong tile! -${penalty}s`, "bad");

      feedbackTimeout = setTimeout(()=>{ 
        if(timerId) setMessage('Find the odd tile!',"neutral");
      },2500);

      if(timer<=0) endGame();
    }
  }

  // STARTER BOARD (tap to start)
  function buildStarterBoard(){
    const starterGrid = 3;
    board.style.gridTemplateColumns = `repeat(${starterGrid}, 1fr)`;
    board.innerHTML = '';

    const hue = Math.floor(Math.random()*360);
    const sat = 60 + Math.random()*20;
    const baseLight = 45 + Math.random()*10;

    for(let i=0;i<9;i++){
      const diff = (Math.random()*10 - 5);
      const light = baseLight + diff;

      const tile = document.createElement('div');
      tile.className = 'tile';
      tile.style.background = `hsl(${hue} ${sat}% ${light}%)`;
      tile.addEventListener('click', startGame);

      board.appendChild(tile);
    }
  }

  buildStarterBoard();
  startStarterAnimation();
  startBtn.addEventListener('click', startGame);
  resetBtn.addEventListener('click', resetGame);

})();
</script>
</body>
</html>